name: CD Docker Deployment

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Deploy with Docker
      uses: appleboy/ssh-action@v1
      with:
        host: course.prafdin.ru
        username: gregory
        port: 2465
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          # –õ–æ–≥–∏–Ω –≤ GitHub Container Registry
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          
          # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
          docker stop catty-reminders || true
          docker rm catty-reminders || true
          
          # üî• –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –°–¢–ê–†–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
          sudo systemctl stop catty-reminders || true
          
          # Pull –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
          docker pull ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
          docker run -d \
            --name catty-reminders \
            -p 8181:8181 \
            --restart unless-stopped \
            ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
          
          echo "üöÄ Docker deployment completed!"
        
