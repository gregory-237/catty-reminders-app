name: CD Docker Deployment

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Deploy with Docker
      uses: appleboy/ssh-action@v1
      with:
        host: course.prafdin.ru
        username: gregory
        port: 2465
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          
          docker stop catty-reminders || true
          docker rm catty-reminders || true
          
          systemctl stop catty-reminders || true
          
          docker pull ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
          
          docker run -d \
            --name catty-reminders \
            -p 8181:8181 \
            --restart unless-stopped \
            ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
          
          echo "ðŸš€ Docker deployment completed!"
        
